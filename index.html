<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Application Anti-Harc√®lement Scolaire</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-shadow {
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="min-h-screen gradient-bg">
    <div id="app" class="container mx-auto px-4 py-8">
        <!-- Page d'accueil -->
        <div id="homePage" class="max-w-4xl mx-auto">
            <div class="bg-white rounded-lg card-shadow p-8 mb-8">
                <div class="text-center mb-8">
                    <div id="logoContainer" class="mb-6">
                        <div class="w-24 h-24 mx-auto bg-blue-100 rounded-full flex items-center justify-center">
                            <svg class="w-12 h-12 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                        </div>
                    </div>
                    <h1 id="schoolTitle" class="text-xl font-bold text-gray-800 mb-4">Application Anti-Harc√®lement Scolaire</h1>
                    <p class="text-lg text-gray-600">Plateforme s√©curis√©e de signalement et de gestion</p>
                </div>

                <!-- Informations l√©gales -->
                <div class="bg-red-50 border-l-4 border-red-400 p-6 mb-8">
                    <h2 class="text-xl font-semibold text-red-800 mb-4">‚ö†Ô∏è Rappel √† la loi et informations importantes</h2>
                    <div class="text-red-700 space-y-2">
                        <p><strong>Article 222-33-2-2 du Code p√©nal :</strong> Le harc√®lement scolaire est un d√©lit puni de 3 ans d'emprisonnement et 45 000‚Ç¨ d'amende.</p>
                        <p><strong>Num√©ro d'urgence :</strong> 3020 (Num√©ro national "Non au harc√®lement")</p>
                        <p><strong>Cyberharc√®lement :</strong> 3018 (Num√©ro national gratuit)</p>
                        <p><strong>Urgence :</strong> 15 (SAMU) - 17 (Police) - 18 (Pompiers) - 112 (Urgences europ√©ennes)</p>
                        <p class="text-sm mt-4">Cette application respecte le RGPD. Vos donn√©es sont prot√©g√©es et utilis√©es uniquement dans le cadre de la lutte contre le harc√®lement scolaire.</p>
                    </div>
                </div>

                <!-- Boutons principaux -->
                <div class="grid md:grid-cols-3 gap-6">
                    <button onclick="showStudentLogin()" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-6 px-6 rounded-lg transition duration-300 transform hover:scale-105">
                        <div class="text-center">
                            <svg class="w-12 h-12 mx-auto mb-3" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z"/>
                            </svg>
                            <div class="text-lg">Identification √âl√®ves</div>
                        </div>
                    </button>

                    <button onclick="showReferentLogin()" class="bg-green-600 hover:bg-green-700 text-white font-semibold py-6 px-6 rounded-lg transition duration-300 transform hover:scale-105">
                        <div class="text-center">
                            <svg class="w-12 h-12 mx-auto mb-3" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"/>
                            </svg>
                            <div class="text-lg">R√©f√©rent Phare</div>
                        </div>
                    </button>

                    <button onclick="showAdminLogin()" class="bg-purple-600 hover:bg-purple-700 text-white font-semibold py-6 px-6 rounded-lg transition duration-300 transform hover:scale-105">
                        <div class="text-center">
                            <svg class="w-12 h-12 mx-auto mb-3" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"/>
                            </svg>
                            <div class="text-lg">Administrateur</div>
                        </div>
                    </button>
                </div>
            </div>
        </div>

        <!-- Page de connexion √©l√®ve -->
        <div id="studentLoginPage" class="hidden max-w-md mx-auto">
            <div class="bg-white rounded-lg card-shadow p-8">
                <button onclick="showHome()" class="mb-6 text-blue-600 hover:text-blue-800 flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"/>
                    </svg>
                    Retour
                </button>
                
                <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Connexion √âl√®ve</h2>
                
                <form id="studentLoginForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Identifiant (fourni par le coll√®ge)</label>
                        <input type="text" id="studentId" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="nom.prenom" required>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Classe</label>
                        <select id="studentClass" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            <option value="">S√©lectionner votre classe</option>
                            <option value="6G1">6G1</option>
                            <option value="6G2">6G2</option>
                            <option value="6G3">6G3</option>
                            <option value="6G4">6G4</option>
                            <option value="6G5">6G5</option>
                            <option value="6G6">6G6</option>
                            <option value="6G7">6G7</option>
                            <option value="6G8">6G8</option>
                            <option value="6G9">6G9</option>
                            <option value="5G1">5G1</option>
                            <option value="5G2">5G2</option>
                            <option value="5G3">5G3</option>
                            <option value="5G4">5G4</option>
                            <option value="5G5">5G5</option>
                            <option value="5G6">5G6</option>
                            <option value="5G7">5G7</option>
                            <option value="5G8">5G8</option>
                            <option value="5G9">5G9</option>
                            <option value="4G1">4G1</option>
                            <option value="4G2">4G2</option>
                            <option value="4G3">4G3</option>
                            <option value="4G4">4G4</option>
                            <option value="4G5">4G5</option>
                            <option value="4G6">4G6</option>
                            <option value="4G7">4G7</option>
                            <option value="4G8">4G8</option>
                            <option value="4G9">4G9</option>
                            <option value="3G1">3G1</option>
                            <option value="3G2">3G2</option>
                            <option value="3G3">3G3</option>
                            <option value="3G4">3G4</option>
                            <option value="3G5">3G5</option>
                            <option value="3G6">3G6</option>
                            <option value="3G7">3G7</option>
                            <option value="3G8">3G8</option>
                            <option value="3G9">3G9</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Mot de passe provisoire</label>
                        <input type="password" id="studentTempPassword" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    
                    <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-md transition duration-300">
                        Se connecter
                    </button>
                </form>
            </div>
        </div>

        <!-- Page de signalement √©l√®ve -->
        <div id="studentReportPage" class="hidden max-w-2xl mx-auto">
            <div class="bg-white rounded-lg card-shadow p-8">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">Signaler une situation</h2>
                    <button onclick="studentLogout()" class="text-red-600 hover:text-red-800">D√©connexion</button>
                </div>
                
                <form id="reportForm" class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Vous √™tes :</label>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="radio" name="role" value="victime" class="mr-2" required>
                                <span>Victime de harc√®lement</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="role" value="temoin" class="mr-2" required>
                                <span>T√©moin de harc√®lement</span>
                            </label>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Lieu des faits</label>
                        <select id="location" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            <option value="">S√©lectionner le lieu</option>
                            <option value="cour">Cour de r√©cr√©ation</option>
                            <option value="classe">Salle de classe</option>
                            <option value="couloir">Couloirs</option>
                            <option value="cantine">Cantine</option>
                            <option value="toilettes">Toilettes</option>
                            <option value="transport">Transport scolaire</option>
                            <option value="internet">Internet/R√©seaux sociaux</option>
                            <option value="autre">Autre</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Fr√©quence</label>
                        <select id="frequency" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            <option value="">S√©lectionner la fr√©quence</option>
                            <option value="quotidien">Tous les jours</option>
                            <option value="hebdomadaire">Plusieurs fois par semaine</option>
                            <option value="occasionnel">De temps en temps</option>
                            <option value="unique">Une seule fois</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Description de la situation</label>
                        <textarea id="description" rows="6" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="D√©crivez la situation de harc√®lement..." required></textarea>
                    </div>

                    <button type="submit" class="w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-3 px-4 rounded-md transition duration-300">
                        Envoyer le signalement
                    </button>
                </form>
            </div>
        </div>

        <!-- Page de connexion r√©f√©rent -->
        <div id="referentLoginPage" class="hidden max-w-md mx-auto">
            <div class="bg-white rounded-lg card-shadow p-8">
                <button onclick="showHome()" class="mb-6 text-blue-600 hover:text-blue-800 flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"/>
                    </svg>
                    Retour
                </button>
                
                <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Connexion R√©f√©rent Phare</h2>
                
                <form id="referentLoginForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Mot de passe r√©f√©rent</label>
                        <input type="password" id="referentPassword" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500" required>
                    </div>
                    
                    <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-md transition duration-300">
                        Se connecter
                    </button>
                </form>
            </div>
        </div>

        <!-- Page tableau de bord r√©f√©rent -->
        <div id="referentDashboard" class="hidden max-w-6xl mx-auto">
            <div class="bg-white rounded-lg card-shadow p-8">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">Tableau de bord R√©f√©rent Phare</h2>
                    <button onclick="referentLogout()" class="text-red-600 hover:text-red-800">D√©connexion</button>
                </div>

                <!-- Export Configuration -->
                <div class="mb-8 p-6 bg-blue-50 rounded-lg">
                    <h3 class="text-lg font-semibold mb-4">üì• Sauvegarde des donn√©es</h3>
                    <div>
                        <h4 class="text-md font-medium mb-2">Exporter la configuration</h4>
                        <p class="text-sm text-gray-600 mb-3">Sauvegarde compl√®te : √©l√®ves, signalements, param√®tres</p>
                        <button onclick="exportConfiguration()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md">
                            üì• T√©l√©charger sauvegarde
                        </button>
                    </div>
                    
                    <!-- Instructions GitHub -->
                    <div class="mt-6 p-4 bg-white border-l-4 border-blue-400 rounded">
                        <h4 class="font-semibold text-blue-800 mb-2">üìö Pour GitHub Pages :</h4>
                        <div class="text-sm text-blue-700 space-y-1">
                            <p><strong>1.</strong> Exportez votre configuration avant de publier</p>
                            <p><strong>2.</strong> Chaque utilisateur aura la m√™me configuration initiale</p>
                            <p><strong>3.</strong> Les donn√©es restent locales √† chaque appareil</p>
                            <p><strong>4.</strong> Utilisez export/import pour synchroniser entre appareils</p>
                        </div>
                    </div>
                </div>

                <!-- Gestion liste √©l√®ves -->
                <div class="mb-8 p-6 bg-gray-50 rounded-lg">
                    <h3 class="text-lg font-semibold mb-4">Gestion de la liste des √©l√®ves</h3>
                    
                    <!-- Import par copier-coller -->
                    <div class="mb-6">
                        <h4 class="text-md font-medium mb-2">Importation en lot (copier-coller depuis Excel)</h4>
                        <p class="text-sm text-gray-600 mb-3">Copiez les colonnes depuis Excel dans l'ordre : Identifiant | Classe | Mot de passe provisoire</p>
                        <textarea id="studentDataPaste" rows="8" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="Exemple :
martin.jean	6A	temp123
dupont.marie	6B	temp456
bernard.paul	5A	temp789"></textarea>
                        <div class="flex gap-4 mt-3">
                            <button onclick="importFromPaste()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md">Importer les donn√©es</button>
                            <button onclick="clearPasteArea()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-md">Effacer</button>
                        </div>
                    </div>
                    
                    <!-- Ajout manuel d'√©l√®ve -->
                    <div class="border-t pt-6">
                        <h4 class="text-md font-medium mb-3">Ajout manuel d'un √©l√®ve</h4>
                        <div class="grid md:grid-cols-4 gap-4">
                            <input type="text" id="newStudentId" placeholder="nom.prenom" class="px-3 py-2 border border-gray-300 rounded-md">
                            <select id="newStudentClass" class="px-3 py-2 border border-gray-300 rounded-md">
                                <option value="">Classe</option>
                                <option value="6G1">6G1</option>
                                <option value="6G2">6G2</option>
                                <option value="6G3">6G3</option>
                                <option value="6G4">6G4</option>
                                <option value="6G5">6G5</option>
                                <option value="6G6">6G6</option>
                                <option value="6G7">6G7</option>
                                <option value="6G8">6G8</option>
                                <option value="6G9">6G9</option>
                                <option value="5G1">5G1</option>
                                <option value="5G2">5G2</option>
                                <option value="5G3">5G3</option>
                                <option value="5G4">5G4</option>
                                <option value="5G5">5G5</option>
                                <option value="5G6">5G6</option>
                                <option value="5G7">5G7</option>
                                <option value="5G8">5G8</option>
                                <option value="5G9">5G9</option>
                                <option value="4G1">4G1</option>
                                <option value="4G2">4G2</option>
                                <option value="4G3">4G3</option>
                                <option value="4G4">4G4</option>
                                <option value="4G5">4G5</option>
                                <option value="4G6">4G6</option>
                                <option value="4G7">4G7</option>
                                <option value="4G8">4G8</option>
                                <option value="4G9">4G9</option>
                                <option value="3G1">3G1</option>
                                <option value="3G2">3G2</option>
                                <option value="3G3">3G3</option>
                                <option value="3G4">3G4</option>
                                <option value="3G5">3G5</option>
                                <option value="3G6">3G6</option>
                                <option value="3G7">3G7</option>
                                <option value="3G8">3G8</option>
                                <option value="3G9">3G9</option>
                            </select>
                            <input type="text" id="newStudentTempPass" placeholder="Mot de passe provisoire" class="px-3 py-2 border border-gray-300 rounded-md">
                            <button onclick="addStudent()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md">Ajouter</button>
                        </div>
                    </div>
                </div>

                <!-- Liste des √©l√®ves -->
                <div class="mb-8">
                    <h3 class="text-lg font-semibold mb-4">Liste des √©l√®ves inscrits</h3>
                    <div class="overflow-x-auto">
                        <table class="min-w-full bg-white border border-gray-200 rounded-lg">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">Identifiant</th>
                                    <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">Classe</th>
                                    <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">Mot de passe provisoire</th>
                                    <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">Mot de passe g√©n√©r√©</th>
                                    <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">Statut</th>
                                </tr>
                            </thead>
                            <tbody id="studentsTableBody">
                                <!-- Les √©l√®ves seront affich√©s ici -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Liste des signalements -->
                <div>
                    <h3 class="text-lg font-semibold mb-4">Signalements re√ßus</h3>
                    <div id="reportsList" class="space-y-4">
                        <!-- Les signalements seront affich√©s ici -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Page de connexion administrateur -->
        <div id="adminLoginPage" class="hidden max-w-md mx-auto">
            <div class="bg-white rounded-lg card-shadow p-8">
                <button onclick="showHome()" class="mb-6 text-blue-600 hover:text-blue-800 flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"/>
                    </svg>
                    Retour
                </button>
                
                <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Connexion Administrateur</h2>
                
                <form id="adminLoginForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Mot de passe administrateur</label>
                        <input type="password" id="adminPassword" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500" required>
                    </div>
                    
                    <button type="submit" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-semibold py-2 px-4 rounded-md transition duration-300">
                        Se connecter
                    </button>
                </form>
            </div>
        </div>

        <!-- Page tableau de bord administrateur -->
        <div id="adminDashboard" class="hidden max-w-4xl mx-auto">
            <div class="bg-white rounded-lg card-shadow p-8">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">Tableau de bord Administrateur</h2>
                    <button onclick="adminLogout()" class="text-red-600 hover:text-red-800">D√©connexion</button>
                </div>

                <!-- Import Configuration -->
                <div class="mb-8 p-6 bg-green-50 rounded-lg">
                    <h3 class="text-lg font-semibold mb-4">üì§ Restauration des donn√©es</h3>
                    <div>
                        <h4 class="text-md font-medium mb-2">Importer une configuration</h4>
                        <p class="text-sm text-gray-600 mb-3">Restaure une sauvegarde pr√©c√©dente</p>
                        <input type="file" id="configFile" accept=".json" class="mb-3 text-sm w-full">
                        <button onclick="importConfiguration()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md">
                            üì§ Restaurer sauvegarde
                        </button>
                    </div>
                </div>

                <div class="grid md:grid-cols-2 gap-6">
                    <!-- Upload logo -->
                    <div class="p-6 bg-gray-50 rounded-lg">
                        <h3 class="text-lg font-semibold mb-4">Logo de l'√©tablissement</h3>
                        <input type="file" id="logoFile" accept="image/*" class="mb-4">
                        <button onclick="uploadLogo()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md">
                            T√©l√©charger logo
                        </button>
                    </div>

                    <!-- Changement nom √©tablissement -->
                    <div class="p-6 bg-gray-50 rounded-lg">
                        <h3 class="text-lg font-semibold mb-4">Nom de l'√©tablissement</h3>
                        <input type="text" id="schoolNameInput" placeholder="Nom de l'√©tablissement" class="w-full px-3 py-2 border border-gray-300 rounded-md mb-4">
                        <button onclick="changeSchoolName()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md">
                            Modifier
                        </button>
                    </div>

                    <!-- Changement mot de passe r√©f√©rent -->
                    <div class="p-6 bg-gray-50 rounded-lg">
                        <h3 class="text-lg font-semibold mb-4">Changer mot de passe r√©f√©rent</h3>
                        <input type="password" id="newReferentPassword" placeholder="Nouveau mot de passe" class="w-full px-3 py-2 border border-gray-300 rounded-md mb-4">
                        <button onclick="changeReferentPassword()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md">
                            Modifier
                        </button>
                    </div>

                    <!-- R√©initialisation -->
                    <div class="p-6 bg-red-50 rounded-lg">
                        <h3 class="text-lg font-semibold mb-4 text-red-800">‚ö†Ô∏è Zone dangereuse</h3>
                        <p class="text-sm text-red-600 mb-4">Supprime toutes les donn√©es de l'application</p>
                        <button onclick="resetApplication()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md">
                            R√©initialiser l'application
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal pour afficher le mot de passe g√©n√©r√© -->
        <div id="passwordModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg p-8 max-w-md mx-4 shadow-2xl">
                <div class="text-center mb-6">
                    <div class="w-16 h-16 mx-auto bg-green-100 rounded-full flex items-center justify-center mb-4">
                        <svg class="w-8 h-8 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                        </svg>
                    </div>
                    <h3 class="text-2xl font-bold text-green-800 mb-2">üéâ Inscription r√©ussie !</h3>
                    <p class="text-gray-600">Premi√®re connexion - Mot de passe g√©n√©r√©</p>
                </div>

                <div class="bg-blue-50 border-2 border-blue-200 rounded-lg p-6 mb-6">
                    <h4 class="text-lg font-semibold text-blue-800 mb-3 text-center">üîê VOTRE NOUVEAU MOT DE PASSE :</h4>
                    <div class="bg-white border-2 border-blue-300 rounded-lg p-4 text-center">
                        <span id="generatedPassword" class="text-2xl font-mono font-bold text-blue-900 select-all"></span>
                    </div>
                    <button onclick="copyPassword()" class="w-full mt-3 bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-md transition duration-300">
                        üìã Copier le mot de passe
                    </button>
                </div>

                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6">
                    <h4 class="font-semibold text-yellow-800 mb-2">üìù ACTIONS OBLIGATOIRES :</h4>
                    <ul class="text-sm text-yellow-700 space-y-1">
                        <li>1Ô∏è‚É£ Notez ce mot de passe sur papier</li>
                        <li>2Ô∏è‚É£ Photographiez cet √©cran</li>
                        <li>3Ô∏è‚É£ Copiez-le dans vos notes</li>
                    </ul>
                </div>

                <div class="bg-red-50 border-l-4 border-red-400 p-4 mb-6">
                    <h4 class="font-semibold text-red-800 mb-2">‚ö†Ô∏è TR√àS IMPORTANT :</h4>
                    <ul class="text-sm text-red-700 space-y-1">
                        <li>‚Ä¢ L'ancien mot de passe ne fonctionne plus</li>
                        <li>‚Ä¢ Ne partagez JAMAIS ce mot de passe</li>
                        <li>‚Ä¢ Si perdu, contactez le r√©f√©rent Phare</li>
                    </ul>
                </div>

                <div class="space-y-3">
                    <button onclick="closePasswordModal()" class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-4 rounded-md transition duration-300">
                        ‚úÖ J'ai sauvegard√© mon mot de passe
                    </button>
                    <button onclick="backToLogin()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-md transition duration-300">
                        üîô Retour √† l'identification
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ========================================
        // CONFIGURATION INITIALE - √Ä MODIFIER AVANT DIFFUSION
        // ========================================
        const INITIAL_CONFIG = {
            schoolName: "Coll√®ge [NOM DE VOTRE √âTABLISSEMENT]", // Changez le nom ici
            referentPassword: "Ph@re2025", // Changez ce mot de passe
            initialStudents: [
                // { id: "test.eleve", class: "6G1", tempPassword: "test123", password: null }
            ]
        };

        // Logo par d√©faut en base64 (remplacez par votre logo si n√©cessaire)
        const DEFAULT_LOGO_BASE64 = null; // "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAA..."

        // ========================================
        // √âTAT DE L'APPLICATION
        // ========================================
        let appState = {};
        let currentUser = null; // Donn√©e de session, non persist√©e
        const adminPassword = '@dmiP@steur2025'; // Mot de passe fixe

        // ========================================
        // INITIALISATION
        // ========================================
        document.addEventListener('DOMContentLoaded', function() {
            initializeApplication();
            setupEventListeners();
        });

        function initializeApplication() {
            loadState();
            updateDisplay();
        }

        function loadState() {
            try {
                const savedState = localStorage.getItem('antiHarcelementAppState');
                if (savedState) {
                    appState = JSON.parse(savedState);
                } else {
                    // Premier chargement, initialisation depuis la configuration
                    appState = {
                        schoolName: INITIAL_CONFIG.schoolName,
                        schoolLogo: DEFAULT_LOGO_BASE64,
                        referentPassword: INITIAL_CONFIG.referentPassword,
                        studentsList: INITIAL_CONFIG.initialStudents || [],
                        reportsList: [],
                        appInitialized: true
                    };
                    saveState();
                }
            } catch (error) {
                console.error("Erreur lors du chargement de l'√©tat, r√©initialisation de l'√©tat.", error);
                // En cas d'erreur de parsing, on r√©initialise l'√©tat
                appState = {
                    schoolName: INITIAL_CONFIG.schoolName,
                    schoolLogo: DEFAULT_LOGO_BASE64,
                    referentPassword: INITIAL_CONFIG.referentPassword,
                    studentsList: INITIAL_CONFIG.initialStudents || [],
                    reportsList: [],
                    appInitialized: true
                };
                saveState();
            }
        }

        function saveState() {
            try {
                localStorage.setItem('antiHarcelementAppState', JSON.stringify(appState));
            } catch (error) {
                console.error("Erreur lors de la sauvegarde de l'√©tat :", error);
                alert("Une erreur critique est survenue. Impossible de sauvegarder les modifications. Veuillez exporter vos donn√©es si possible.");
            }
        }

        function updateDisplay() {
            if (appState.schoolName) {
                document.getElementById('schoolTitle').textContent = appState.schoolName;
            }
            if (appState.schoolLogo) {
                document.getElementById('logoContainer').innerHTML = `<img src="${appState.schoolLogo}" alt="Logo √©tablissement" class="w-24 h-24 mx-auto rounded-full object-cover">`;
            } else {
                document.getElementById('logoContainer').innerHTML = `
                    <div class="w-24 h-24 mx-auto bg-blue-100 rounded-full flex items-center justify-center">
                        <svg class="w-12 h-12 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                    </div>`;
            }
        }

        // ========================================
        // EXPORT/IMPORT CONFIGURATION
        // ========================================
        function exportConfiguration() {
            try {
                const configToExport = {
                    version: "2.0",
                    exportDate: new Date().toISOString(),
                    ...appState
                };

                const dataStr = JSON.stringify(configToExport, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                const fileName = `config_antiharcellement_${new Date().toISOString().split('T')[0]}.json`;
                link.download = fileName;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                setTimeout(() => URL.revokeObjectURL(link.href), 100);

                alert(`‚úÖ Configuration export√©e avec succ√®s !\n\nFichier: ${fileName}\nContenu:\n‚Ä¢ ${appState.studentsList.length} √©l√®ve(s)\n‚Ä¢ ${appState.reportsList.length} signalement(s)`);
            } catch (error) {
                console.error('Erreur export:', error);
                alert('‚ùå Erreur lors de l\'exportation !');
            }
        }

        function importConfiguration() {
            const fileInput = document.getElementById('configFile');
            const file = fileInput.files[0];
            if (!file) {
                alert('‚ö†Ô∏è Veuillez s√©lectionner un fichier de configuration (.json)');
                return;
            }

            if (!confirm('‚ö†Ô∏è ATTENTION - IMPORTATION DESTRUCTIVE !\n\nCette action va REMPLACER D√âFINITIVEMENT toutes les donn√©es actuelles. Voulez-vous vraiment continuer ?')) {
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const config = JSON.parse(e.target.result);
                    if (config.version !== "2.0" || !config.studentsList || config.reportsList === undefined) {
                        throw new Error('Fichier de configuration invalide, corrompu ou d\'une version incompatible.');
                    }

                    appState = {
                        schoolName: config.schoolName,
                        schoolLogo: config.schoolLogo,
                        referentPassword: config.referentPassword,
                        studentsList: config.studentsList,
                        reportsList: config.reportsList,
                        appInitialized: config.appInitialized
                    };
                    
                    saveState();
                    updateDisplay();
                    displayStudents();
                    displayReports();

                    fileInput.value = '';
                    alert(`‚úÖ IMPORTATION R√âUSSIE !\n\nConfiguration restaur√©e :\n‚Ä¢ ${appState.studentsList.length} √©l√®ve(s)\n‚Ä¢ ${appState.reportsList.length} signalement(s)`);
                } catch (error) {
                    console.error('Erreur import:', error);
                    alert(`‚ùå ERREUR D'IMPORTATION !\n\n${error.message}`);
                }
            };
            reader.readAsText(file);
        }

        function setupEventListeners() {
            document.getElementById('studentLoginForm').addEventListener('submit', e => { e.preventDefault(); handleStudentLogin(); });
            document.getElementById('reportForm').addEventListener('submit', e => { e.preventDefault(); handleReport(); });
            document.getElementById('referentLoginForm').addEventListener('submit', e => { e.preventDefault(); handleReferentLogin(); });
            document.getElementById('adminLoginForm').addEventListener('submit', e => { e.preventDefault(); handleAdminLogin(); });
        }

        // Navigation
        function showHome() { hideAllPages(); document.getElementById('homePage').classList.remove('hidden'); }
        function showStudentLogin() { hideAllPages(); document.getElementById('studentLoginPage').classList.remove('hidden'); }
        function showReferentLogin() { hideAllPages(); document.getElementById('referentLoginPage').classList.remove('hidden'); }
        function showAdminLogin() { hideAllPages(); document.getElementById('adminLoginPage').classList.remove('hidden'); }
        function hideAllPages() {
            ['homePage', 'studentLoginPage', 'studentReportPage', 'referentLoginPage', 'referentDashboard', 'adminLoginPage', 'adminDashboard'].forEach(page => {
                document.getElementById(page).classList.add('hidden');
            });
        }

        // Gestion des connexions
        function handleStudentLogin() {
            const studentId = document.getElementById('studentId').value.trim().toLowerCase();
            const studentClass = document.getElementById('studentClass').value;
            const tempPassword = document.getElementById('studentTempPassword').value.trim();

            const student = appState.studentsList.find(s => s.id.toLowerCase() === studentId && s.class === studentClass && s.tempPassword === tempPassword);

            if (student && !student.password) {
                const newPassword = generatePassword();
                student.password = newPassword;
                saveState();
                
                // Sauvegarder le mot de passe sur l'appareil de l'√©l√®ve (non critique, aide √† la connexion)
                try {
                    localStorage.setItem(`student_${studentId}_${studentClass}`, newPassword);
                } catch (e) { console.warn("Impossible de sauvegarder le mot de passe localement pour l'√©l√®ve.")}

                showPasswordModal(newPassword);
                currentUser = student;
            } else {
                const studentWithPassword = appState.studentsList.find(s => s.id.toLowerCase() === studentId && s.class === studentClass && s.password === tempPassword);
                if (studentWithPassword) {
                    currentUser = studentWithPassword;
                    hideAllPages();
                    document.getElementById('studentReportPage').classList.remove('hidden');
                } else {
                    alert('‚ùå CONNEXION √âCHOU√âE\n\nV√©rifiez vos identifiants ou contactez le r√©f√©rent Phare si vous avez perdu votre mot de passe personnel.');
                }
            }
        }

        function handleReferentLogin() {
            const password = document.getElementById('referentPassword').value;
            if (password === appState.referentPassword) {
                hideAllPages();
                document.getElementById('referentDashboard').classList.remove('hidden');
                displayStudents();
                displayReports();
            } else {
                alert('Mot de passe incorrect.');
            }
        }

        function handleAdminLogin() {
            const password = document.getElementById('adminPassword').value;
            if (password === adminPassword) {
                hideAllPages();
                document.getElementById('adminDashboard').classList.remove('hidden');
                document.getElementById('schoolNameInput').value = appState.schoolName;
            } else {
                alert('Mot de passe incorrect.');
            }
        }

        // Gestion des signalements
        function handleReport() {
            const report = {
                id: Date.now(),
                studentId: currentUser.id,
                studentClass: currentUser.class,
                role: document.querySelector('input[name="role"]:checked').value,
                location: document.getElementById('location').value,
                frequency: document.getElementById('frequency').value,
                description: document.getElementById('description').value,
                date: new Date().toLocaleDateString('fr-FR'),
                seen: false,
                treated: false
            };
            appState.reportsList.push(report);
            saveState();
            alert('Votre signalement a √©t√© envoy√© avec succ√®s.');
            document.getElementById('reportForm').reset();
        }

        // Gestion r√©f√©rent
        function importFromPaste() {
            const pasteData = document.getElementById('studentDataPaste').value.trim();
            if (!pasteData) return alert('‚ö†Ô∏è Veuillez coller les donn√©es.');

            const lines = pasteData.split('\n');
            const newStudents = [];
            lines.forEach(line => {
                const parts = line.split(/\t+/).map(part => part.trim());
                if (parts.length >= 3) {
                    const [id, sClass, tempPassword] = parts;
                    if (id && sClass && tempPassword && !appState.studentsList.find(s => s.id === id && s.class === sClass)) {
                        newStudents.push({ id: id.toLowerCase(), class: sClass, tempPassword, password: null });
                    }
                }
            });

            if (newStudents.length > 0) {
                appState.studentsList.push(...newStudents);
                saveState();
                displayStudents();
                document.getElementById('studentDataPaste').value = '';
                alert(`‚úÖ ${newStudents.length} √©l√®ve(s) import√©(s) avec succ√®s.`);
            } else {
                alert('‚ùå Aucun nouvel √©l√®ve √† importer. V√©rifiez le format ou les doublons.');
            }
        }

        function clearPasteArea() { document.getElementById('studentDataPaste').value = ''; }

        function addStudent() {
            const id = document.getElementById('newStudentId').value.trim().toLowerCase();
            const studentClass = document.getElementById('newStudentClass').value;
            const tempPassword = document.getElementById('newStudentTempPass').value.trim();

            if (!id || !studentClass || !tempPassword) return alert('‚ö†Ô∏è Veuillez remplir tous les champs.');
            if (appState.studentsList.find(s => s.id === id && s.class === studentClass)) return alert('üîÑ Cet √©l√®ve existe d√©j√†.');

            appState.studentsList.push({ id, class: studentClass, tempPassword, password: null });
            saveState();
            displayStudents();
            document.getElementById('newStudentId').value = '';
            document.getElementById('newStudentClass').value = '';
            document.getElementById('newStudentTempPass').value = '';
            alert('‚úÖ √âl√®ve ajout√© avec succ√®s.');
        }

        function displayStudents() {
            const tbody = document.getElementById('studentsTableBody');
            if (appState.studentsList.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="px-4 py-8 text-center text-gray-500">Aucun √©l√®ve inscrit</td></tr>';
                return;
            }
            tbody.innerHTML = appState.studentsList.map(student => `
                <tr class="border-b border-gray-200 hover:bg-gray-50">
                    <td class="px-4 py-3 text-sm">${student.id}</td>
                    <td class="px-4 py-3 text-sm">${student.class}</td>
                    <td class="px-4 py-3 text-sm font-mono">${student.tempPassword}</td>
                    <td class="px-4 py-3 text-sm font-mono">${student.password || '-'}</td>
                    <td class="px-4 py-3 text-sm">
                        <span class="px-2 py-1 rounded-full text-xs ${student.password ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}">
                            ${student.password ? 'Inscrit' : 'En attente'}
                        </span>
                    </td>
                </tr>
            `).join('');
        }

        function displayReports() {
            const container = document.getElementById('reportsList');
            if (appState.reportsList.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">Aucun signalement re√ßu.</p>';
                return;
            }
            container.innerHTML = appState.reportsList.map(report => `
                <div class="border border-gray-200 rounded-lg p-6 ${report.seen ? 'bg-gray-50' : 'bg-yellow-50'}">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h4 class="font-semibold text-lg">Signalement #${report.id}</h4>
                            <p class="text-sm text-gray-600">√âl√®ve: ${report.studentId} (${report.studentClass}) - ${report.date}</p>
                        </div>
                        <div class="flex gap-4">
                            <label class="flex items-center"><input type="checkbox" ${report.seen ? 'checked' : ''} onchange="toggleSeen(${report.id})" class="mr-2">Vu</label>
                            <label class="flex items-center"><input type="checkbox" ${report.treated ? 'checked' : ''} onchange="toggleTreated(${report.id})" class="mr-2">Trait√©</label>
                        </div>
                    </div>
                    <p><strong>R√¥le:</strong> ${report.role} | <strong>Lieu:</strong> ${report.location} | <strong>Fr√©quence:</strong> ${report.frequency}</p>
                    <p class="mt-2 p-3 bg-white rounded border"><strong>Description:</strong> ${report.description}</p>
                </div>
            `).join('');
        }

        function toggleSeen(reportId) {
            const report = appState.reportsList.find(r => r.id === reportId);
            if (report) {
                report.seen = !report.seen;
                saveState();
                displayReports(); // Re-render to update style
            }
        }

        function toggleTreated(reportId) {
            const report = appState.reportsList.find(r => r.id === reportId);
            if (report) {
                report.treated = !report.treated;
                saveState();
            }
        }

        // Gestion administrateur
        function uploadLogo() {
            const file = document.getElementById('logoFile').files[0];
            if (!file) return alert('Veuillez s√©lectionner un fichier image.');
            const reader = new FileReader();
            reader.onload = e => {
                appState.schoolLogo = e.target.result;
                saveState();
                updateDisplay();
                alert('Logo t√©l√©charg√© avec succ√®s.');
            };
            reader.readAsDataURL(file);
        }

        function changeSchoolName() {
            const newName = document.getElementById('schoolNameInput').value.trim();
            if (!newName) return alert('Veuillez saisir un nom d\'√©tablissement.');
            appState.schoolName = newName;
            saveState();
            updateDisplay();
            alert('Nom de l\'√©tablissement modifi√© avec succ√®s.');
        }

        function changeReferentPassword() {
            const newPassword = document.getElementById('newReferentPassword').value;
            if (!newPassword) return alert('Veuillez saisir un nouveau mot de passe.');
            appState.referentPassword = newPassword;
            saveState();
            document.getElementById('newReferentPassword').value = '';
            alert('Mot de passe r√©f√©rent modifi√© avec succ√®s.');
        }

        function resetApplication() {
            if (!confirm('‚ö†Ô∏è R√âINITIALISATION COMPL√àTE !\n\nCette action va SUPPRIMER D√âFINITIVEMENT toutes les donn√©es. √ätes-vous s√ªr ?')) return;
            if (!confirm('‚ö†Ô∏è DERNI√àRE CONFIRMATION !\n\nCette action est IRR√âVERSIBLE. Continuer ?')) return;

            localStorage.removeItem('antiHarcelementAppState');
            loadState(); // Re-load initial state
            updateDisplay();
            showHome();
            alert('‚úÖ R√âINITIALISATION TERMIN√âE !');
        }

        // D√©connexions
        function studentLogout() { currentUser = null; showHome(); }
        function referentLogout() { showHome(); }
        function adminLogout() { showHome(); }

        // Modal de mot de passe
        function showPasswordModal(password) {
            document.getElementById('generatedPassword').textContent = password;
            document.getElementById('passwordModal').classList.remove('hidden');
        }
        function closePasswordModal() {
            document.getElementById('passwordModal').classList.add('hidden');
            if (currentUser) {
                hideAllPages();
                document.getElementById('studentReportPage').classList.remove('hidden');
            } else {
                showHome();
            }
        }
        function backToLogin() {
            document.getElementById('passwordModal').classList.add('hidden');
            currentUser = null;
            document.getElementById('studentLoginForm').reset();
            showStudentLogin();
        }
        function copyPassword() {
            const password = document.getElementById('generatedPassword').textContent;
            navigator.clipboard.writeText(password).then(() => alert('‚úÖ Mot de passe copi√© !'));
        }

        // Utilitaires
        function generatePassword() {
            return Math.random().toString(36).slice(-8);
        }
    </script>
</body>
</html>
